(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63d8ad3c"],{"3b2b":function(e,t,r){var n=r("7726"),a=r("5dbc"),i=r("86cc").f,o=r("9093").f,u=r("aae3"),s=r("0bfb"),c=n.RegExp,l=c,f=c.prototype,p=/a/g,d=/a/g,m=new c(p)!==p;if(r("9e1e")&&(!m||r("79e5")((function(){return d[r("2b4c")("match")]=!1,c(p)!=p||c(d)==d||"/a/i"!=c(p,"i")})))){c=function(e,t){var r=this instanceof c,n=u(e),i=void 0===t;return!r&&n&&e.constructor===c&&i?e:a(m?new l(n&&!i?e.source:e,t):l((n=e instanceof c)?e.source:e,n&&i?s.call(e):t),r?this:f,c)};for(var h=function(e){e in c||i(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},v=o(l),b=0;v.length>b;)h(v[b++]);f.constructor=c,c.prototype=f,r("2aba")(n,"RegExp",c)}r("7a56")("RegExp")},"3dbd":function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return u})),r.d(t,"a",(function(){return s}));var n=r("b32d"),a=function(){return Object(n["a"])({url:"/services",method:"get"})},i=function(e,t){return Object(n["a"])({url:"/services/".concat(e),method:"PUT",data:t})},o=function(e){return Object(n["a"])({url:"/services/".concat(e),method:"GET"})},u=function(e){return Object(n["a"])({url:"/services/".concat(e),method:"DELETE"})},s=function(e){return Object(n["a"])({url:"/services",method:"POST",data:e})}},4917:function(e,t,r){"use strict";var n=r("cb7c"),a=r("9def"),i=r("0390"),o=r("5f1b");r("214f")("match",1,(function(e,t,r,u){return[function(r){var n=e(this),a=void 0==r?void 0:r[t];return void 0!==a?a.call(r,n):new RegExp(r)[t](String(n))},function(e){var t=u(r,e,this);if(t.done)return t.value;var s=n(e),c=String(this);if(!s.global)return o(s,c);var l=s.unicode;s.lastIndex=0;var f,p=[],d=0;while(null!==(f=o(s,c))){var m=String(f[0]);p[d]=m,""===m&&(s.lastIndex=i(c,a(s.lastIndex),l)),d++}return 0===d?null:p}]}))},"5dbc":function(e,t,r){var n=r("d3f4"),a=r("8b97").set;e.exports=function(e,t,r){var i,o=t.constructor;return o!==r&&"function"==typeof o&&(i=o.prototype)!==r.prototype&&n(i)&&a&&a(e,i),e}},"7b78":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px","show-message":!1}},[r("el-form-item",{attrs:{label:"Desc"}},[r("el-input",{attrs:{placeholder:"Description"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),r("el-form-item",{attrs:{label:"URIs",prop:"uris"}},[r("el-select",{attrs:{"allow-create":"",filterable:"",multiple:"","default-first-option":"",placeholder:e.$t("schema.route.inputMultipleValues")},on:{change:e.filterUriOptions},model:{value:e.form.uris,callback:function(t){e.$set(e.form,"uris",t)},expression:"form.uris"}},e._l(e.ExistedUris,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"Hosts",prop:"hosts",placeholder:"Hosts"}},[r("el-select",{attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:e.$t("schema.route.inputMultipleValues")},model:{value:e.form.hosts,callback:function(t){e.$set(e.form,"hosts",t)},expression:"form.hosts"}},e._l(e.ExistedHosts,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),r("p",{staticClass:"tip"},[e._v("\n        "+e._s(e.$t("schema.route.propertyHostsTip"))+"\n      ")])],1),r("el-form-item",{attrs:{label:"Remote Address",prop:"remote_addr"}},[r("el-input",{attrs:{placeholder:"Remote Address"},model:{value:e.form.remote_addr,callback:function(t){e.$set(e.form,"remote_addr",t)},expression:"form.remote_addr"}})],1),r("el-form-item",{attrs:{label:"Methods"}},[r("el-select",{attrs:{multiple:"",placeholder:"Methods"},model:{value:e.form.methods,callback:function(t){e.$set(e.form,"methods",t)},expression:"form.methods"}},e._l(e.methods,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"Upstream",prop:"upstream_id"}},[r("el-select",{attrs:{placeholder:"Upstream",clearable:"",filterable:""},model:{value:e.form.upstream_id,callback:function(t){e.$set(e.form,"upstream_id",t)},expression:"form.upstream_id"}},e._l(e.upstreamList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.desc,value:e.id}})})),1)],1),r("el-form-item",{attrs:{label:"Service",prop:"service_id"}},[r("el-select",{attrs:{placeholder:"Service",clearable:"",filterable:""},model:{value:e.form.service_id,callback:function(t){e.$set(e.form,"service_id",t)},expression:"form.service_id"}},e._l(e.serviceList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.desc,value:e.id}})})),1)],1),e._l(e.form.plugins,(function(t,n){return r("el-form-item",{key:n,staticClass:"plugin-item",attrs:{label:"plugin"}},["tempPlugin"!==n?r("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.showPlugin(n)}}},[e._v("\n        "+e._s(n)+"\n      ")]):e._e(),"tempPlugin"!==n?r("el-button",{attrs:{type:"danger"},on:{click:function(t){return t.preventDefault(),e.removePlugin(n)}}},[e._v("\n        "+e._s(e.$t("button.delete"))+"\n      ")]):e._e(),"tempPlugin"===n?r("el-select",{staticClass:"plugin-select",attrs:{value:null,placeholder:"Select a Plugin"},on:{change:e.showPlugin}},e._l(e.filteredPluginList,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1):e._e()],1)})),r("el-form-item",[r("el-button",{attrs:{disabled:!e.filteredPluginList.length},on:{click:e.addPlugin}},[e._v("\n        "+e._s(e.$t("button.add_plugin"))+"\n      ")])],1),r("VarArgs",{attrs:{"p-vars":e.form.vars},on:{"update:pVars":function(t){return e.$set(e.form,"vars",t)},"update:p-vars":function(t){return e.$set(e.form,"vars",t)},onChange:e.onVarArgsChange}}),r("el-form-item",{attrs:{label:"filter_func",prop:"filter_func"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:e.$t("schema.route.fileterFunc")},model:{value:e.form.filter_func,callback:function(t){e.$set(e.form,"filter_func",t)},expression:"form.filter_func"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("\n        "+e._s(e.$t("button.save"))+"\n      ")]),r("el-button",{on:{click:e.toPreviousPage}},[e._v("\n        "+e._s(e.$t("button.cancel"))+"\n      ")])],1)],2),r("PluginDialog",{attrs:{show:e.showPluginDialog,name:e.pluginName,"plugin-data":e.form.plugins[e.pluginName]},on:{hidePlugin:function(t){e.showPluginDialog=!1},save:e.onPluginSave}})],1)},a=[],i=(r("8e6e"),r("bd86")),o=(r("4917"),r("456d"),r("7618")),u=r("768b"),s=(r("ffc1"),r("ac6a"),r("96cf"),r("3b8d")),c=(r("3b2b"),r("a481"),r("7f7f"),r("d225")),l=r("b0b4"),f=r("308d"),p=r("6bb5"),d=r("4e2b"),m=r("9ab4"),h=r("60a3"),v=r("c8f9"),b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",[e._l(e.vars,(function(t,n){return r("el-form-item",{key:n,staticClass:"var-item",attrs:{label:"Var"+(n+1)}},[r("el-form-item",{attrs:{prop:"var."+n+".ip"}},[r("el-select",{attrs:{placeholder:e.$t("schema.route.inputMultipleValues"),filterable:"","allow-create":"","default-first-option":""},on:{change:e.onChange},model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"item.name"}},e._l(e.varNames,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1),r("el-select",{attrs:{placeholder:"Operator"},on:{change:e.onChange},model:{value:t.operator,callback:function(r){e.$set(t,"operator",r)},expression:"item.operator"}},e._l(e.varOperator,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",[r("el-input",{attrs:{placeholder:""},on:{input:e.onChange},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"item.value"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"danger"},on:{click:function(t){return t.preventDefault(),e.removeVar(n)}}},[e._v("\n        "+e._s(e.$t("button.delete"))+"\n      ")])],1)],1)})),r("el-form-item",[r("el-button",{on:{click:e.addVar}},[e._v("\n      "+e._s(e.$t("button.add_var"))+"\n    ")])],1)],2)},g=[],_=(r("8615"),function(e){function t(){var e;return Object(c["a"])(this,t),e=Object(f["a"])(this,Object(p["a"])(t).apply(this,arguments)),e.isFullscreen=!1,e.varNames=["remote_addr","host","uri","http_user_agent","http_referer","http_cookie","http_accept_language","request_uri","query_string","remote_port","hostname","arg_id"],e.varOperator=["==","~=",">","<","~~"],e}return Object(d["a"])(t,e),Object(l["a"])(t,[{key:"onChange",value:function(){var e=this.vars.map((function(e){return Object.values(e)}));this.$emit("update:pVars",e)}},{key:"addVar",value:function(){this.vars.push({name:null,operator:null,value:null}),this.onChange()}},{key:"removeVar",value:function(e){var t=this;this.$confirm("Do you want to remove the var?","Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.vars.splice(e,1),t.onChange();case 2:case"end":return r.stop()}}),r)})))).catch((function(){}))}},{key:"vars",get:function(){var e=this.pVars.map((function(e){var t=Object(u["a"])(e,3),r=t[0],n=t[1],a=t[2];return{name:r,operator:n,value:a}}));return e}}]),t}(h["c"]));m["a"]([Object(h["b"])({default:function(){return[]}})],_.prototype,"pVars",void 0),_=m["a"]([Object(h["a"])({name:"VarArgs"})],_);var O=_,y=O,k=r("2877"),w=Object(k["a"])(y,b,g,!1,null,null,null),j=w.exports,x=r("80a7"),P=r("7d98"),$=r("b5f7"),E=r("3dbd"),R=r("e741"),T=r("6ebf");function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=function(e){function t(){var e;return Object(c["a"])(this,t),e=Object(f["a"])(this,Object(p["a"])(t).apply(this,arguments)),e.form={uris:[],hosts:[],remote_addr:"",upstream_id:"",service_id:"",methods:[],plugins:{},vars:[],desc:"",filter_func:""},e.ExistedUris=[{}],e.ExistedHosts=[{}],e.validateFilterFuncRegexp=/^function\(\)[^]*?\bend$/,e.rules={uris:{required:!0},filter_func:[{pattern:e.validateFilterFuncRegexp,trigger:"blur",message:T["a"].t("schema.route.fileterFunc")}]},e.isEditMode=!1,e.methods=["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],e.pluginList=[],e.pluginName="",e.showPluginDialog=!1,e.upstreamList=[],e.serviceList=[],e}return Object(d["a"])(t,e),Object(l["a"])(t,[{key:"created",value:function(){this.isEditMode=-1===this.$route.name.indexOf("Create"),this.isEditMode&&this.getData(),this.getPluginList(),this.getUpstreamList(),this.getServiceList()}},{key:"reset",value:function(){this.form={uris:[],hosts:[],remote_addr:"",upstream_id:"",service_id:"",methods:[],plugins:{},vars:[],desc:"",filter_func:""}}},{key:"filterDataWithRegex",value:function(e,t){if(e.length>0){var r=[];e.filter((function(e){"string"===typeof e&&(e=e.replace(/\s+/g,""),t.test(e)&&r.push(e))})),r.map((function(t,r){e[r]=t})),e.length>r.length&&e.splice(r.length,e.length)}}},{key:"filterUriOptions",value:function(e){this.filterDataWithRegex(e,new RegExp("^([\\*\\./0-9a-zA-Z-_~@\\?\\!#$\\(\\)]+)$"))}},{key:"getData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o,u,s,c,l,f,p,d,m,h,v,b,g,_,O,y,k,w,j,P,$,E;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$route.params.id,e.next=3,Object(x["c"])(t);case 3:r=e.sent,n=r.node.value,a=n.uri,i=void 0===a?"":a,o=n.uris,u=void 0===o?[]:o,s=n.hosts,c=void 0===s?[]:s,l=n.host,f=void 0===l?"":l,p=n.remote_addr,d=void 0===p?"":p,m=n.upstream_id,h=void 0===m?"":m,v=n.service_id,b=void 0===v?"":v,g=n.methods,_=void 0===g?[]:g,O=n.plugins,y=void 0===O?{}:O,k=n.vars,w=void 0===k?[]:k,j=n.desc,P=void 0===j?"":j,$=n.filter_func,E=void 0===$?"":$,0===c.length&&f.length>0&&c.push(f),0===u.length&&i.length>0&&u.push(i),this.form={uris:u,hosts:c,remote_addr:d,upstream_id:h,service_id:b,methods:_,plugins:y,vars:w,desc:P,filter_func:E};case 32:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onSubmit",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.form.validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(r,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=16;break}if(a=Object.assign({},t.form),a.methods.length||delete a.methods,Object.entries(a).forEach((function(e){var t=Object(u["a"])(e,2),r=t[0],n=t[1];"object"===Object(o["a"])(a[r])?"plugins"!==r&&0===Object.keys(n).length&&delete a[r]:""===n&&delete a[r]})),delete a["tempPlugin"],!t.isEditMode){e.next=10;break}return e.next=8,Object(x["e"])(t.$route.params.id,a);case 8:e.next=12;break;case 10:return e.next=12,Object(x["a"])(a);case 12:t.$message.success("".concat(t.isEditMode?"Update the":"Create a"," service successfully!")),t.isEditMode||(R["a"].delView(t.$route),t.$nextTick((function(){t.$router.push({name:"SchemaRoutesList"})}))),e.next=18;break;case 16:return n.filter_func&&t.$message.warning(n.filter_func[0].message),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"toPreviousPage",value:function(){this.$router.go(-1)}},{key:"getUpstreamList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object($["c"])();case 2:t=e.sent,r=t.node.nodes,n=void 0===r?[]:r,this.upstreamList=n.map((function(e){var t=e.key.match(/\/([0-9]+)/)[1];return L({},e.value,{id:t})}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getServiceList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(E["c"])();case 2:t=e.sent,r=t.node.nodes,n=void 0===r?[]:r,this.serviceList=n.map((function(e){var t=e.key.match(/\/([0-9]+)/)[1];return L({},e.value,{id:t})}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getPluginList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(P["a"])();case 2:this.pluginList=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showPlugin",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.pluginName=t,this.showPluginDialog=!0;case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onPluginSave",value:function(e,t){delete this.form.plugins["tempPlugin"],this.showPluginDialog=!1,this.form.plugins[e]=t}},{key:"addPlugin",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.form.plugins.hasOwnProperty("tempPlugin")){e.next=2;break}return e.abrupt("return");case 2:this.form.plugins=L({},this.form.plugins,{tempPlugin:null});case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"removePlugin",value:function(e){var t=this;this.$confirm("Do you want to remove ".concat(e," plugin?"),"Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:h["c"].delete(t.form.plugins,e);case 1:case"end":return r.stop()}}),r)})))).catch((function(){}))}},{key:"onVarArgsChange",value:function(e){this.form.vars=e}},{key:"filteredPluginList",get:function(){var e=this;return this.pluginList.filter((function(t){return!e.form.plugins.hasOwnProperty(t)}))}}]),t}(h["c"]);C=m["a"]([Object(h["a"])({name:"RouterEdit",components:{PluginDialog:v["a"],VarArgs:j}})],C);var S=C,V=S,U=(r("7bb4"),Object(k["a"])(V,n,a,!1,null,null,null));t["default"]=U.exports},"7bb4":function(e,t,r){"use strict";var n=r("f908"),a=r.n(n);a.a},"80a7":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return u})),r.d(t,"a",(function(){return s}));var n=r("b32d"),a=function(){return Object(n["a"])({url:"/routes",method:"GET"})},i=function(e,t){return Object(n["a"])({url:"/routes/".concat(e),method:"PUT",data:t})},o=function(e){return Object(n["a"])({url:"/routes/".concat(e),method:"GET"})},u=function(e){return Object(n["a"])({url:"/routes/".concat(e),method:"DELETE"})},s=function(e){return Object(n["a"])({url:"/routes",method:"POST",data:e})}},8615:function(e,t,r){var n=r("5ca1"),a=r("504c")(!1);n(n.S,"Object",{values:function(e){return a(e)}})},"8b97":function(e,t,r){var n=r("d3f4"),a=r("cb7c"),i=function(e,t){if(a(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{n=r("9b43")(Function.call,r("11e9").f(Object.prototype,"__proto__").set,2),n(e,[]),t=!(e instanceof Array)}catch(a){t=!0}return function(e,r){return i(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:i}},b5f7:function(e,t,r){"use strict";r.d(t,"e",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return u})),r.d(t,"c",(function(){return s}));var n=r("b32d"),a=function(e,t){return Object(n["a"])({url:"/upstreams/".concat(e),method:"PUT",data:t})},i=function(e){return Object(n["a"])({url:"/upstreams/".concat(e),method:"GET"})},o=function(e){return Object(n["a"])({url:"/upstreams/".concat(e),method:"DELETE"})},u=function(e){return Object(n["a"])({url:"/upstreams",method:"POST",data:e})},s=function(){return Object(n["a"])({url:"/upstreams",method:"GET"})}},f908:function(e,t,r){e.exports={menuBg:"#304156",menuText:"#bfcbd9",menuActiveText:"#409eff"}}}]);